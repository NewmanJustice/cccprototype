{% extends "layout.njk" %}

{% block pageTitle %}Manage Assessments - Admin{% endblock %}

{% block content %}
<div class="govuk-width-container">
  <main class="govuk-main-wrapper" id="main-content" role="main">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <a href="/admin" class="govuk-back-link">Back to dashboard</a>
        
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h1 class="govuk-heading-xl">Manage Assessments</h1>
          <a href="/admin/logout" class="govuk-link">Sign out</a>
        </div>
        
        <p class="govuk-body">Total features in catalogue: <strong>{{ totalFeatures }}</strong></p>
        
        {% if assessments.length > 0 %}
        <table class="govuk-table" style="margin-top: 30px;">
          <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <th scope="col" class="govuk-table__header">Code</th>
              <th scope="col" class="govuk-table__header">User Name</th>
              <th scope="col" class="govuk-table__header">Service Name</th>
              <th scope="col" class="govuk-table__header">Service Type</th>
              <th scope="col" class="govuk-table__header">Progress</th>
              <th scope="col" class="govuk-table__header">Last Updated</th>
              <th scope="col" class="govuk-table__header">Actions</th>
            </tr>
          </thead>
          <tbody class="govuk-table__body">
            {% for assessment in assessments %}
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><strong>{{ assessment.code }}</strong></td>
              <td class="govuk-table__cell">{{ assessment.user_name }}</td>
              <td class="govuk-table__cell">{{ assessment.service_name }}</td>
              <td class="govuk-table__cell">{{ assessment.service_type }}</td>
              <td class="govuk-table__cell">
                <strong class="govuk-tag {% if assessment.percent_complete == 100 %}govuk-tag--green{% elif assessment.percent_complete > 50 %}govuk-tag--blue{% elif assessment.percent_complete > 0 %}govuk-tag--yellow{% else %}govuk-tag--grey{% endif %}">
                  {{ assessment.percent_complete }}%
                </strong>
                <br>
                <span class="govuk-body-s" style="color: #505a5f;">{{ assessment.responses_count }}/{{ totalFeatures }} features</span>
              </td>
              <td class="govuk-table__cell">{{ assessment.updated_at }}</td>
              <td class="govuk-table__cell">
                <a href="/assessment/{{ assessment.id }}/summary" class="govuk-link" target="_blank">View</a> |
                <form method="POST" action="/admin/assessment/{{ assessment.id }}/delete" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this assessment?');">
                  <button type="submit" class="govuk-link" style="border: none; background: none; padding: 0; color: #d4351c; cursor: pointer;">Delete</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p class="govuk-body">No assessments found.</p>
        {% endif %}
      </div>
    </div>
  </main>
</div>
{% endblock %}
