{% extends "layout.njk" %}

{% block pageTitle %}Feature Set Replaced - Admin{% endblock %}

{% block content %}
<div class="govuk-width-container">
  <main class="govuk-main-wrapper" id="main-content" role="main">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <div class="govuk-panel govuk-panel--confirmation">
          <h1 class="govuk-panel__title">Feature set replaced</h1>
          <div class="govuk-panel__body">
            {{ results.inserted }} new features imported
          </div>
        </div>

        <h2 class="govuk-heading-l">Summary</h2>

        <dl class="govuk-summary-list">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Features archived</dt>
            <dd class="govuk-summary-list__value">
              <strong class="govuk-tag govuk-tag--blue">{{ archivedCount }}</strong>
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">New features imported</dt>
            <dd class="govuk-summary-list__value">
              <strong class="govuk-tag govuk-tag--green">{{ results.inserted }}</strong>
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Rows skipped</dt>
            <dd class="govuk-summary-list__value">
              {% if results.skipped > 0 %}
              <strong class="govuk-tag govuk-tag--red">{{ results.skipped }}</strong>
              {% else %}
              <strong class="govuk-tag govuk-tag--grey">0</strong>
              {% endif %}
            </dd>
          </div>
        </dl>

        {% if results.errors.length > 0 %}
        <h2 class="govuk-heading-m">Errors</h2>
        <p class="govuk-body">The following rows could not be processed:</p>
        
        <table class="govuk-table">
          <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <th scope="col" class="govuk-table__header">Row</th>
              <th scope="col" class="govuk-table__header">Error</th>
            </tr>
          </thead>
          <tbody class="govuk-table__body">
            {% for error in results.errors %}
            <tr class="govuk-table__row">
              <td class="govuk-table__cell">{{ error.row }}</td>
              <td class="govuk-table__cell">{{ error.message }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endif %}

        <div class="govuk-inset-text">
          <p class="govuk-body">
            <strong>The previous feature set has been archived.</strong><br>
            You can view it and any associated legacy assessments in 
            <a href="/admin/legacy-features/{{ legacySetId }}" class="govuk-link">Legacy Feature Sets</a>.
          </p>
        </div>

        <div class="govuk-button-group">
          <a href="/admin/features" class="govuk-button" data-module="govuk-button">
            View new features
          </a>
          <a href="/admin/legacy-features" class="govuk-button govuk-button--secondary" data-module="govuk-button">
            View legacy feature sets
          </a>
        </div>
      </div>
    </div>
  </main>
</div>
{% endblock %}
